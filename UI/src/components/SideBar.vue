<script setup>
import { useRouter } from "vue-router";
import { onMounted, onUnmounted } from "vue";
import { useUpdateStore } from "../composables/useUpdateStore.js";

const router = useRouter();
const { updateState, checkForUpdates, clearNotification } = useUpdateStore();

function logout() {
  // clear session/cookie, then:
  router.push("/login");
}

let updateCheckInterval = null;

onMounted(() => {
  // Check for updates immediately
  checkForUpdates();
  
  // Check for updates every 30 minutes (1800000ms)
  updateCheckInterval = setInterval(checkForUpdates, 1800000);
});

onUnmounted(() => {
  if (updateCheckInterval) {
    clearInterval(updateCheckInterval);
  }
});

// Clear update notification when user visits settings
function navigateToSettings() {
  clearNotification();
  router.push("/settings");
}
</script>

<template>
  <div class="flex min-h-screen">
    <div class="w-64 text-black bg-[#FFFFFF] justify-items-start">
      <div class="py-4 px-6">
        <a href="/">
          <img
            src="../assets/icons/ETS.svg"
            alt="Bdeblogo"
            class="w-24 mb-2 mt-8"
          />
        </a>
      </div>
      <div class="mb-10">
        <router-link
          to="/console"
          class="flex items-center font-bold px-6 py-2.5 gap-2 hover:text-red-400"
          active-class="text-red-400"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            x="0px"
            y="0px"
            width="40"
            height="40"
            viewBox="0,0,256,256"
          >
            <g
              fill="#000000"
              fill-rule="nonzero"
              stroke="none"
              stroke-width="1"
              stroke-linecap="butt"
              stroke-linejoin="miter"
              stroke-miterlimit="10"
              stroke-dasharray=""
              stroke-dashoffset="0"
              font-family="none"
              font-weight="none"
              font-size="none"
              text-anchor="none"
              style="mix-blend-mode: normal"
            >
              <g transform="scale(5.33333,5.33333)">
                <path
                  d="M12.5,6c-3.57194,0 -6.5,2.92806 -6.5,6.5v23c0,3.57194 2.92806,6.5 6.5,6.5h23c3.57194,0 6.5,-2.92806 6.5,-6.5v-23c0,-3.57194 -2.92806,-6.5 -6.5,-6.5zM12.5,9h23c1.95006,0 3.5,1.54994 3.5,3.5v1.5h-30v-1.5c0,-1.95006 1.54994,-3.5 3.5,-3.5zM9,17h30v18.5c0,1.95006 -1.54994,3.5 -3.5,3.5h-23c-1.95006,0 -3.5,-1.54994 -3.5,-3.5zM17.48438,21.98438c-0.61065,0.00015 -1.16026,0.37042 -1.38978,0.93629c-0.22952,0.56587 -0.09314,1.21439 0.34486,1.63988l2.93945,2.93945l-2.93945,2.93945c-0.39185,0.37623 -0.54969,0.9349 -0.41265,1.46055c0.13704,0.52565 0.54754,0.93616 1.07319,1.07319c0.52565,0.13704 1.08432,-0.0208 1.46055,-0.41265l4,-4c0.58555,-0.58579 0.58555,-1.5353 0,-2.12109l-4,-4c-0.28248,-0.2909 -0.67069,-0.45506 -1.07617,-0.45508zM25.5,30c-0.54095,-0.00765 -1.04412,0.27656 -1.31683,0.74381c-0.27271,0.46725 -0.27271,1.04514 0,1.51238c0.27271,0.46725 0.77588,0.75146 1.31683,0.74381h6c0.54095,0.00765 1.04412,-0.27656 1.31683,-0.74381c0.27271,-0.46725 0.27271,-1.04514 0,-1.51238c-0.27271,-0.46725 -0.77588,-0.75146 -1.31683,-0.74381z"
                ></path>
              </g>
            </g>
          </svg>

          Console
        </router-link>
      </div>
      <div class="mb-10">
        <router-link
          to="/board"
          class="flex items-center font-bold px-6 py-2.5 gap-2 hover:text-red-400"
          active-class="text-red-400"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            x="0px"
            y="0px"
            width="40"
            height="40"
            viewBox="0,0,256,256"
          >
            <g
              fill="#000000"
              fill-rule="nonzero"
              stroke="none"
              stroke-width="1"
              stroke-linecap="butt"
              stroke-linejoin="miter"
              stroke-miterlimit="10"
              stroke-dasharray=""
              stroke-dashoffset="0"
              font-family="none"
              font-weight="none"
              font-size="none"
              text-anchor="none"
              style="mix-blend-mode: normal"
            >
              <g transform="scale(5.33333,5.33333)">
                <path
                  d="M12.5,6c-3.57194,0 -6.5,2.92806 -6.5,6.5v23c0,3.57194 2.92806,6.5 6.5,6.5h23c3.57194,0 6.5,-2.92806 6.5,-6.5v-23c0,-3.57194 -2.92806,-6.5 -6.5,-6.5zM12.5,9h23c1.95006,0 3.5,1.54994 3.5,3.5v1.5h-30v-1.5c0,-1.95006 1.54994,-3.5 3.5,-3.5zM9,17h30v18.5c0,1.95006 -1.54994,3.5 -3.5,3.5h-23c-1.95006,0 -3.5,-1.54994 -3.5,-3.5zM17.48438,21.98438c-0.61065,0.00015 -1.16026,0.37042 -1.38978,0.93629c-0.22952,0.56587 -0.09314,1.21439 0.34486,1.63988l2.93945,2.93945l-2.93945,2.93945c-0.39185,0.37623 -0.54969,0.9349 -0.41265,1.46055c0.13704,0.52565 0.54754,0.93616 1.07319,1.07319c0.52565,0.13704 1.08432,-0.0208 1.46055,-0.41265l4,-4c0.58555,-0.58579 0.58555,-1.5353 0,-2.12109l-4,-4c-0.28248,-0.2909 -0.67069,-0.45506 -1.07617,-0.45508zM25.5,30c-0.54095,-0.00765 -1.04412,0.27656 -1.31683,0.74381c-0.27271,0.46725 -0.27271,1.04514 0,1.51238c0.27271,0.46725 0.77588,0.75146 1.31683,0.74381h6c0.54095,0.00765 1.04412,-0.27656 1.31683,-0.74381c0.27271,-0.46725 0.27271,-1.04514 0,-1.51238c-0.27271,-0.46725 -0.77588,-0.75146 -1.31683,-0.74381z"
                ></path>
              </g>
            </g>
          </svg>

          Annonces
        </router-link>
      </div>
      <div class="mb-10">
        <router-link
          to="/background"
          class="flex items-center font-bold px-6 py-2.5 gap-2 hover:text-red-400"
          active-class="text-red-400"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            x="0px"
            y="0px"
            width="40"
            height="40"
            viewBox="0,0,256,256"
          >
            <g
              fill="#000000"
              fill-rule="nonzero"
              stroke="none"
              stroke-width="1"
              stroke-linecap="butt"
              stroke-linejoin="miter"
              stroke-miterlimit="10"
              stroke-dasharray=""
              stroke-dashoffset="0"
              font-family="none"
              font-weight="none"
              font-size="none"
              text-anchor="none"
              style="mix-blend-mode: normal"
            >
              <g transform="scale(5.33333,5.33333)">
                <path
                  d="M11.5,6c-3.01977,0 -5.5,2.48023 -5.5,5.5v25c0,3.01977 2.48023,5.5 5.5,5.5h25c3.01977,0 5.5,-2.48023 5.5,-5.5v-25c0,-3.01977 -2.48023,-5.5 -5.5,-5.5zM11.5,9h25c1.39823,0 2.5,1.10177 2.5,2.5v25c0,0.13261 -0.01993,0.26013 -0.03906,0.38672l-12.14648,-11.75195c-0.77859,-0.75335 -1.79698,-1.12891 -2.81445,-1.12891c-1.01748,0 -2.03391,0.37556 -2.8125,1.12891l-12.14844,11.75195c-0.01913,-0.12659 -0.03906,-0.25411 -0.03906,-0.38672v-25c0,-1.39823 1.10177,-2.5 2.5,-2.5zM30.5,13c-1.375,0 -2.59618,0.56963 -3.37109,1.44141c-0.77491,0.87177 -1.12891,1.97526 -1.12891,3.05859c0,1.08333 0.354,2.18682 1.12891,3.05859c0.77491,0.87177 1.99609,1.44141 3.37109,1.44141c1.375,0 2.59618,-0.56963 3.37109,-1.44141c0.77491,-0.87177 1.12891,-1.97526 1.12891,-3.05859c0,-1.08333 -0.354,-2.18682 -1.12891,-3.05859c-0.77491,-0.87177 -1.99609,-1.44141 -3.37109,-1.44141zM30.5,16c0.625,0 0.90382,0.18037 1.12891,0.43359c0.22509,0.25323 0.37109,0.64974 0.37109,1.06641c0,0.41667 -0.146,0.81318 -0.37109,1.06641c-0.22509,0.25323 -0.50391,0.43359 -1.12891,0.43359c-0.625,0 -0.90382,-0.18037 -1.12891,-0.43359c-0.22509,-0.25323 -0.37109,-0.64974 -0.37109,-1.06641c0,-0.41667 0.146,-0.81318 0.37109,-1.06641c0.22509,-0.25323 0.50391,-0.43359 1.12891,-0.43359zM24.00195,26.98828c0.25956,0 0.51815,0.10108 0.72656,0.30273l12.07227,11.67969c-0.09956,0.01166 -0.19768,0.0293 -0.30078,0.0293h-25c-0.1031,0 -0.20123,-0.01764 -0.30078,-0.0293l12.07422,-11.67969c0.20841,-0.20165 0.46895,-0.30273 0.72852,-0.30273z"
                ></path>
              </g>
            </g>
          </svg>

          Fond d'écran
        </router-link>
      </div>
      <div class="mb-10">
        <router-link
          to="/title_card"
          class="flex items-center font-bold px-6 py-2.5 gap-2 hover:text-red-400"
          active-class="text-red-400"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            x="0px"
            y="0px"
            width="40"
            height="40"
            viewBox="0,0,256,256"
          >
            <g
              fill="#000000"
              fill-rule="nonzero"
              stroke="none"
              stroke-width="1"
              stroke-linecap="butt"
              stroke-linejoin="miter"
              stroke-miterlimit="10"
              stroke-dasharray=""
              stroke-dashoffset="0"
              font-family="none"
              font-weight="none"
              font-size="none"
              text-anchor="none"
              style="mix-blend-mode: normal"
            >
              <g transform="scale(5.33333,5.33333)">
                <path
                  d="M11.5,6c-3.01977,0 -5.5,2.48023 -5.5,5.5v25c0,3.01977 2.48023,5.5 5.5,5.5h25c3.01977,0 5.5,-2.48023 5.5,-5.5v-25c0,-3.01977 -2.48023,-5.5 -5.5,-5.5zM11.5,9h25c1.39823,0 2.5,1.10177 2.5,2.5v25c0,1.39823 -1.10177,2.5 -2.5,2.5h-25c-1.39823,0 -2.5,-1.10177 -2.5,-2.5v-25c0,-1.39823 1.10177,-2.5 2.5,-2.5zM17.5,16c-0.54095,-0.00765 -1.04412,0.27656 -1.31683,0.74381c-0.27271,0.46725 -0.27271,1.04514 0,1.51238c0.27271,0.46725 0.77588,0.75146 1.31683,0.74381h13c0.54095,0.00765 1.04412,-0.27656 1.31683,-0.74381c0.27271,-0.46725 0.27271,-1.04514 0,-1.51238c-0.27271,-0.46725 -0.77588,-0.75146 -1.31683,-0.74381zM14.5,22.5c-0.54095,-0.00765 -1.04412,0.27656 -1.31683,0.74381c-0.27271,0.46725 -0.27271,1.04514 0,1.51238c0.27271,0.46725 0.77588,0.75146 1.31683,0.74381h19c0.54095,0.00765 1.04412,-0.27656 1.31683,-0.74381c0.27271,-0.46725 0.27271,-1.04514 0,-1.51238c-0.27271,-0.46725 -0.77588,-0.75146 -1.31683,-0.74381zM17.5,29c-0.54095,-0.00765 -1.04412,0.27656 -1.31683,0.74381c-0.27271,0.46725 -0.27271,1.04514 0,1.51238c0.27271,0.46725 0.77588,0.75146 1.31683,0.74381h13c0.54095,0.00765 1.04412,-0.27656 1.31683,-0.74381c0.27271,-0.46725 0.27271,-1.04514 0,-1.51238c-0.27271,-0.46725 -0.77588,-0.75146 -1.31683,-0.74381z"
                ></path>
              </g>
            </g>
          </svg>

          Alertes
        </router-link>
      </div>
      <div class="mb-10">
        <div class="relative">
          <router-link
            to="/settings"
            @click="navigateToSettings"
            class="flex items-center font-bold px-6 py-2.5 gap-2 hover:text-red-400"
            active-class="text-red-400"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              x="0px"
              y="0px"
              width="40"
              height="40"
              viewBox="0,0,256,256"
            >
              <g
                fill="#000000"
                fill-rule="nonzero"
                stroke="none"
                stroke-width="1"
                stroke-linecap="butt"
                stroke-linejoin="miter"
                stroke-miterlimit="10"
                stroke-dasharray=""
                stroke-dashoffset="0"
                font-family="none"
                font-weight="none"
                font-size="none"
                text-anchor="none"
                style="mix-blend-mode: normal"
              >
                <g transform="scale(5.33333,5.33333)">
                  <path
                    d="M24,4c-1.5769,0 -3.09734,0.19943 -4.54883,0.53711c-0.62033,0.14479 -1.08158,0.66555 -1.15039,1.29883l-0.31836,2.90234c-0.10412,0.95108 -0.65351,1.79257 -1.48242,2.27148c-0.82726,0.47796 -1.83138,0.5309 -2.70703,0.14648h-0.00195l-2.66602,-1.17383c-0.58279,-0.25647 -1.26399,-0.1171 -1.69922,0.34766c-2.07249,2.20951 -3.6631,4.88499 -4.56641,7.87109c-0.1844,0.6091 0.03558,1.26826 0.54883,1.64453l2.36523,1.73438c0.77236,0.56784 1.22656,1.46272 1.22656,2.41992c0,0.95771 -0.4542,1.85334 -1.22656,2.41992l-2.36523,1.73242c-0.51325,0.37627 -0.73323,1.03543 -0.54883,1.64453c0.90321,2.98579 2.49255,5.66324 4.56641,7.87305c0.4357,0.46407 1.11683,0.60265 1.69922,0.3457l2.66602,-1.17383c0.87608,-0.38529 1.88115,-0.32985 2.70898,0.14844c0.82891,0.47891 1.3783,1.32041 1.48242,2.27148l0.31836,2.90234c0.06933,0.63197 0.52949,1.15161 1.14844,1.29688c1.45215,0.33891 2.97388,0.53906 4.55078,0.53906c1.5769,0 3.09734,-0.19943 4.54883,-0.53711c0.62033,-0.14479 1.08158,-0.66555 1.15039,-1.29883l0.31836,-2.90234c0.10412,-0.95108 0.65351,-1.79257 1.48242,-2.27148c0.82726,-0.47796 1.83138,-0.53285 2.70703,-0.14844l2.66797,1.17383c0.58239,0.25695 1.26352,0.11837 1.69922,-0.3457c2.07249,-2.20951 3.6631,-4.88694 4.56641,-7.87305c0.1844,-0.6091 -0.03558,-1.26826 -0.54883,-1.64453l-2.36523,-1.73242c-0.77237,-0.56658 -1.22656,-1.46221 -1.22656,-2.41992c0,-0.95771 0.4542,-1.85334 1.22656,-2.41992l2.36523,-1.73242c0.51325,-0.37627 0.73323,-1.03543 0.54883,-1.64453c-0.90331,-2.98611 -2.49391,-5.66354 -4.56641,-7.87305c-0.4357,-0.46407 -1.11683,-0.60265 -1.69922,-0.3457l-2.66797,1.17383c-0.87565,0.38442 -1.87977,0.32952 -2.70703,-0.14844c-0.82891,-0.47891 -1.3783,-1.32041 -1.48242,-2.27148l-0.31836,-2.90234c-0.06933,-0.63197 -0.52949,-1.15161 -1.14844,-1.29687c-1.45215,-0.33891 -2.97388,-0.53906 -4.55078,-0.53906zM24,7c0.9743,0 1.90992,0.17488 2.84766,0.33984l0.1875,1.72461c0.20788,1.89892 1.31176,3.58788 2.96484,4.54297c1.65417,0.95571 3.66809,1.06559 5.41602,0.29688l1.58594,-0.69727c1.21784,1.46237 2.18203,3.11415 2.85547,4.92383l-1.40625,1.03125c-1.53963,1.12942 -2.45117,2.9276 -2.45117,4.83789c0,1.91029 0.91154,3.70847 2.45117,4.83789l1.40625,1.03125c-0.67344,1.80968 -1.63763,3.46146 -2.85547,4.92383l-1.58594,-0.69727c-1.74792,-0.76871 -3.76185,-0.65884 -5.41602,0.29688c-1.65309,0.95509 -2.75696,2.64405 -2.96484,4.54297l-0.1875,1.72461c-0.93765,0.1645 -1.87384,0.33984 -2.84766,0.33984c-0.9743,0 -1.90992,-0.17488 -2.84766,-0.33984l-0.1875,-1.72461c-0.20788,-1.89892 -1.31176,-3.58788 -2.96484,-4.54297c-1.65417,-0.95571 -3.66809,-1.06559 -5.41602,-0.29687l-1.58594,0.69727c-1.21807,-1.46216 -2.1821,-3.114 -2.85547,-4.92383l1.40625,-1.03125c1.53963,-1.12942 2.45117,-2.9276 2.45117,-4.83789c0,-1.91029 -0.91228,-3.70964 -2.45117,-4.83984l-1.40625,-1.03125c0.67375,-1.81037 1.63887,-3.46107 2.85742,-4.92383l1.58398,0.69727c1.74792,0.76871 3.76185,0.66079 5.41602,-0.29492c1.65309,-0.95509 2.75696,-2.64405 2.96484,-4.54297l0.1875,-1.72461c0.93765,-0.1645 1.87384,-0.33984 2.84766,-0.33984zM24,16c-4.40051,0 -8,3.59949 -8,8c0,4.40051 3.59949,8 8,8c4.40051,0 8,-3.59949 8,-8c0,-4.40051 -3.59949,-8 -8,-8zM24,19c2.77919,0 5,2.22081 5,5c0,2.77919 -2.22081,5 -5,5c-2.77919,0 -5,-2.22081 -5,-5c0,-2.77919 2.22081,-5 5,-5z"
                  ></path>
                </g>
              </g>
            </svg>

            Paramètres
          </router-link>
          
          <!-- Update notification pill -->
          <div 
            v-if="updateState.available" 
            class="absolute top-2 right-2 w-3 h-3 bg-blue-400 rounded-full animate-pulse border-2 border-[#0A0A0A]"
            title="Mise à jour disponible"
          >
          </div>
        </div>
      </div>
    </div>
  </div>
</template>